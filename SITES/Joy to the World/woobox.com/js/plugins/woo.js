/*
 Woobox Javascript SDK
 2013-2018 Woobox, LLC
*/
if(typeof Woo==="undefined"){var Woo={};(function(){function Woobox(){if(arguments.callee._singletonInstance)return arguments.callee._singletonInstance;arguments.callee._singletonInstance=this;var that=this;var consts={logging:"https://{host}/plugins/log",plugin:{classes:["woobox-offer"],options:{},frames:{"offer":{src:"https://{host}/{pidRaw}{subSegment}{params}",width:"1px",height:"determine","min-width":"100%","max-width":"determine",defaultCSS:{width:"1px","min-width":"100%",border:"none",WebkitBorderRadius:"3px",
MozBorderRadius:"3px",OBorderRadius:"3px",borderRadius:"3px",WebkitTransition:"height 0.2s ease-out",MozTransition:"height 0.2s ease-out",OTransition:"height 0.2s ease-out",transition:"height 0.2s ease-out"},eventHandlers:{}}},classIDMap:{"woobox-offer":"data-offer"},classParamsMap:{"woobox-offer":"data-params"},classParamsValid:["source","from","sms","view","for","chk"],classOptionMap:{"woobox-offer":[]},classFrameMap:{"woobox-offer":["offer"]},classCSSMap:{"woobox-offer":{width:"100%"},"woobox-offer-wrap":{width:"100%",
maxWidth:"810px"},"overlay":{background:"#000",opacity:80}},defaultCSS:{border:"none"},defaultCSSLink:"https://{host}/css/plugins/{class}.css"},errors:{}};var h,k,t;var pm=!!window.postMessage;var ev=!!window.addEventListener;var ie=function(){var v=3,div=document.createElement("div"),a=div.all||[];while(div.innerHTML="\x3c!--[if gt IE "+ ++v+"]><br><![endif]--\x3e",a[0]);return v>4?v:!v}();var plugins={};var plugin_counts={};var logger;var myEl;var url=document.getElementById("woobox-sdk").getAttribute("src");
function fillConst(t,vals){var filled=t;if(h)filled=filled.replace("{host}",h);for(var i in vals)filled=filled.replace("{"+i+"}",vals[i]);return filled}function mergeJSON(json1,json2){for(var i in json2)if(typeof json2[i]!="object")json1[i]=json2[i];else{if(typeof json1[i]=="undefined")json1[i]=json2[i];mergeJSON(json1[i],json2[i])}}function getMessage(e){if(pm){if(e.origin!="https://"+h)return false;var m={};try{m=JSON.parse(e.data);if(m["pid"]&&typeof plugins[m["pid"]]!="undefined"){var p=plugins[m["pid"]];
return p.receiveMessage(e,m)}else return false}catch(ex){return false}}return false}function postMessage(el,pid,d,dest){if(pm){var m={"t":t,"k":k,"pid":pid};mergeJSON(m,d);if(!dest)dest="https://"+h;el.postMessage(JSON.stringify(m),dest);return true}return false}function setCSS(o){if(typeof o.frames!="undefined"&&typeof o.frames.offer!="undefined");if(typeof o.consts!="undefined"){if(typeof o.consts.defaultCSS!="undefined")for(var i in o.consts.defaultCSS)o.el.style[i]=o.consts.defaultCSS[i];if(o.type&&
typeof o.consts.classCSSMap[o.type]!="undefined")for(var i in o.consts.classCSSMap[o.type])o.el.style[i]=o.consts.classCSSMap[o.type][i];var off=o.constructor.name==="frame"?o.parent:o;var isPopup=off.hasOwnProperty("opts")&&off.opts.hasOwnProperty("style")&&off.opts.style==="popup";if(o.constructor.name==="frame"&&isPopup)postMessage(o.el.contentWindow,o.parent.pid,{"addBodyClass":"popup"});if(typeof o.css!="undefined"&&typeof o.css.height=="undefined"){o.css.height="600";o.css.overflow="scroll";
if(!isPopup)o.el.setAttribute("scrolling","yes")}else if(!isPopup)o.el.setAttribute("scrolling","no");for(var i in{"width":true,"height":true,"max-width":true})if(typeof o.consts[i]!="undefined"&&typeof o.css[i]!="undefined")if(o.consts[i].indexOf("%")>0)o.el.style[i]=o.css[i];else o.el.style[i]=o.css[i]+"px";if(typeof WooControl!=="undefined")window.setTimeout(function(){WooControl.setHeight()},10);return true}return false}function log(data){if(logger)document.getElementsByTagName("head")[0].removeChild(logger);
logger=document.createElement("script");logger.setAttribute("id","woobox-log");logger.setAttribute("src",consts.logging+"?d="+encodeURIComponent(JSON.stringify(data)));logger.setAttribute("type","text/javascript");document.getElementsByTagName("head")[0].appendChild(logger)}function parseEmbedScripts(){var allScripts=document.querySelectorAll("script[data-offer]");for(var i=0;i<allScripts.length;i++){var s=allScripts[i];var attrs=s.attributes;if(s.getAttribute("data-offer")){var div=document.createElement("div");
div.setAttribute("class","woobox-offer");div.setAttribute("data-offer",s.getAttribute("data-offer"));if(s.getAttribute("data-style"))div.setAttribute("data-style",s.getAttribute("data-style"));if(s.getAttribute("data-trigger"))div.setAttribute("data-trigger",s.getAttribute("data-trigger"));if(s.getAttribute("data-expire"))div.setAttribute("data-expire",s.getAttribute("data-expire"));s.parentNode.insertBefore(div,s.nextSibling)}}}function parseDOM(){parseEmbedScripts();var validTags=["div"];for(var i=
0;i<validTags.length;i++){var tags=document.getElementsByTagName(validTags[i]),matched=false;for(var j=0;j<tags.length;j++)for(var k=0;k<consts.plugin.classes.length;k++)if(tags[j].className==consts.plugin.classes[k]){var p=new plugin(tags[j],consts.plugin.classes[k]);plugins[p.pid]=p;p.init();matched=true}if(matched)break}if(!matched)console.error("Matching Woobox offer tag not found")}function checkTop(pid){var className=pid+"_offer",topEl=document.getElementsByClassName(className)[0],elBox=topEl.getBoundingClientRect(),
body=document.body,docElem=document.documentElement;var scrollTop=window.pageYOffset||docElem.scrollTop||body.scrollTop;var clientTop=docElem.clientTop||body.clientTop||0;var topLoc=elBox.top+scrollTop-clientTop;var windowBottom=window.innerHeight+scrollTop;topLoc=Math.round(topLoc);if(topLoc<scrollTop||topLoc>windowBottom)smoothScroll(topLoc,scrollTop)}function smoothScroll(destination,current){var hop_count=33;var distance=(destination-current)/hop_count;for(var i=1;i<=hop_count;i++)(function(){var nextHop=
distance*i;setTimeout(function(){window.scrollTo(0,nextHop+current)},15*i)})();return false}function parseQueryString(str){var queries,temp,paramCount=0,params={};queries=str.split("&");if(queries.length){for(var i=0;i<queries.length;i++){temp=queries[i].split("=");if(temp.length>1){paramCount++;params[temp[0]]=temp[1]}}if(paramCount)return params}return false}function toQueryString(obj){var str=[];for(var p in obj)if(obj.hasOwnProperty(p))str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));
if(str.length)return"?"+str.join("&");else return""}function getParams(validParams,dataParams){var hashParams=parseQueryString(window.location.hash.substring(1)),finalParams={};for(var i in hashParams)if(validParams.indexOf(i)>-1)finalParams[i]=hashParams[i];for(var i in dataParams)if(validParams.indexOf(i)>-1)finalParams[i]=dataParams[i];return finalParams}this.selfDestruct=function(){this.frames.forEach(function(f){f.destroy()})};this.box=function(token,key,host){if(typeof WooControl!=="undefined"&&
WooControl.preventEmbeds)return false;if(!host){var a=document.createElement("a");a.setAttribute("href",url);h=a.hostname.replace("cdn.","")}else h=host;t=token;k=key;if(ev)window.addEventListener("message",getMessage,false);else window.attachEvent("onmessage",getMessage);if(document.readyState==="complete"||document.readyState==="loaded"||document.readyState==="interactive")parseDOM();else if(ev)document.addEventListener("DOMContentLoaded",parseDOM,false);else document.attachEvent("onreadystatechange",
parseDOM)};function frame(p,f){this.inited=false;this.parent=p;this.fid=f;this.el=document.createElement("iframe");this.consts=consts.plugin.frames[this.fid];this.el.setAttribute("id",this.parent.pid+"_"+this.fid);if(p.opts.style!=="popup")this.el.setAttribute("scrolling","no");this.el.className=this.parent.pid+"_"+this.fid;this.css={};this.over=false;this.clicked=false}frame.prototype.destroy=function(){this.el.remove()};frame.prototype.init=function(){if(typeof this.parent.pid!="undefined"){var that=
this,src,subSegment="",params=getParams(this.parent.consts.classParamsValid,this.parent.el.getAttribute("data-params"));params["embed"]=1;params["plugin"]=encodeURIComponent(JSON.stringify({"pid":this.parent.pid,"fid":this.fid}));for(var paramkey in this.parent.params)params[paramkey]=this.parent.params[paramkey];switch(this.fid){case "offer":if(params["view"]){subSegment+="/"+params["view"];delete params["view"]}else if(params["url"]){subSegment+="/"+params["url"];delete params["url"]}if(params["from"]){subSegment+=
"/"+params["from"];delete params["from"]}else if(params["for"]){subSegment+="/"+params["for"];delete params["for"]}break}src=fillConst(this.consts.src,{"pidRaw":this.parent.pidRaw,"subSegment":subSegment,"params":toQueryString(params)});this.el.setAttribute("src",src);var el_wrap=document.createElement("div");el_wrap.className="woobox-offer-wrap";el_wrap.appendChild(this.el);this.parent.el_wrap=el_wrap;this.parent.el.appendChild(el_wrap);for(var i in{"width":true,"height":true,"max-width":true})if(this.consts[i]!=
"determine")this.css[i]=this.consts[i];this.setCSS();myEl=that.el;var mousemove=function(e){if(this.consts&&typeof this.consts.eventHandlers.mouseover!="undefined")that.consts.eventHandlers.mousemove(e,that)};if(ev)this.el.addEventListener("mousemove",mousemove,false);else this.el.attachEvent("onmousemove",mousemove);var mouseover=function(e){that.over=true;if(typeof that.consts.eventHandlers.mouseover!="undefined")that.consts.eventHandlers.mouseover(e,that)};if(ev)this.el.addEventListener("mouseover",
mouseover,false);else this.el.attachEvent("onmouseover",mouseover);var mouseout=function(e){that.over=false;if(typeof that.consts.eventHandlers.mouseout!="undefined")that.consts.eventHandlers.mouseout(e,that)};if(ev)this.el.addEventListener("mouseout",mouseout,false);else this.el.attachEvent("onmouseout",mouseout);this.inited=true}};frame.prototype.setCSS=function(){return setCSS(this)};frame.prototype.reload=function(){this.loaded=false;this.el.setAttribute("src",this.el.src)};function plugin(div,
c){this.inited=false;this.layout_width=null;this.consts=consts.plugin;this.type=c;this.el=div;this.el.style.visibility="hidden";this.pid=this.pidRaw=this.el.getAttribute(this.consts.classIDMap[this.type]);if(typeof plugin_counts[this.pid]=="undefined")plugin_counts[this.pid]=0;else plugin_counts[this.pid]++;this.pid=this.pid+"_"+plugin_counts[this.pid];this.firstLoad=true;this.el.id=this.pid;var rawParams=this.el.getAttribute(this.consts.classParamsMap[this.type])||"{}";this.params=JSON.parse(rawParams.replace(/'/g,
'"'));this.opts={};this.frames={};this.loading=false;this.cssLink=null;if(this.consts.classFrameMap[this.type].length)for(var i=0;i<this.consts.classFrameMap.length;i++)this.frames[this.consts.classFrameMap[i]]=new frame(this,this.consts.classFrameMap[i])}plugin.prototype.sendData=function(e,r,d){return postMessage(e.source,this.pid,{"receive":r,"data":d},e.origin)};plugin.prototype.sendRequest=function(e,r,d){return postMessage(e.source,this.pid,{"request":r,"data":d},e.origin)};plugin.prototype.returnTarget=
function(e,m){var p={"receive":"target","data":null};if(m["frame"]){p["request"]="dims";p["frame"]=m["frame"]}return postMessage(e.source,this.pid,p,e.origin)};plugin.prototype.receiveMessage=function(e,m){var secure=false;if(m["t"]&&m["k"]&&m["t"]==t&&m["k"]==k)secure=true;if(typeof m["receive"]!="undefined")switch(m["receive"]){case "dims":if(typeof m["frame"]!="undefined"&&typeof this.frames[m["frame"]]!="undefined"){for(var i in m["data"]["dims"])switch(i){case "width":if(!this.layout_width)this.setLayoutWidth(m["data"]["dims"][i]);
break;case "height":consts.plugin.classCSSMap["woobox-offer-wrap"]["height"]=m["data"]["dims"][i];default:this.frames[m["frame"]].css[i]=m["data"]["dims"][i]}return this.frames[m["frame"]].setCSS()}return false;break;case "checkTop":if(this.firstLoad){this.firstLoad=false;if(m.data.modal)this.setModalStyles(m.data.modal);return false}checkTop(m.pid);break}if(typeof m["request"]!="undefined")switch(m["request"]){case "documentInfo":return this.sendData(e,"documentInfo",util.getDocumentInfo(this.el));
break;case "target":return this.returnTarget(e,m);break}};plugin.prototype.setModalStyles=function(styles){consts.plugin.classCSSMap["overlay"]={background:styles.bgColor||"#000",opacity:styles.opacity||80}};plugin.prototype.init=function(){var that=this;this.setOpts();var popupInterval=window.setInterval(function(){if(that.layout_width){that.applyOpts();window.clearInterval(popupInterval)}},100);this.setCSS();var initInterval=window.setInterval(function(){var busy_count=0;for(var frameKey in that.frames)if(!that.frames[frameKey].inited)busy_count++;
if(!busy_count){that.inited=true;that.setCSSLink();window.clearInterval(initInterval)}},100);this.setFrames()};plugin.prototype.setLayoutWidth=function(w){this.layout_width=w;consts.plugin.classCSSMap["woobox-offer-wrap"]["max-width"]=this.layout_width+"px";return setCSS(this)};plugin.prototype.setCSS=function(){return setCSS(this)};plugin.prototype.closeBox=function(obj,ms){var offer=null;if(obj.hasOwnProperty("el"))offer=obj.el;else{obj.preventDefault();var offerFound=false;var el=obj.target;var i=
0;do{if(util.hasClass(el,"woobox-offer")){offer=el;break}el=el.parentElement;i++}while(i<50)}if(!offer)return false;if(typeof ms==="undefined"||!parseInt(ms))var ms=0;setTimeout(function(){document.documentElement.className=document.documentElement.className.replace("popup_active","");offer.className=offer.className.replace("active","")},ms);return false};plugin.prototype.queueRevealBox=function(obj,ms){var that=this;var offer=obj.hasOwnProperty("el")?obj.el:obj.path[1];if(typeof ms==="undefined"||
!parseInt(ms))var ms=0;setTimeout(function(){that.revealBox()},ms);return true};plugin.prototype.revealBox=function(){if(this.opts.style==="popup"&&this.opts.expire!==0)if(this.readExpireCookie())return false;else this.setExpireCookie(this.opts.expire);document.documentElement.classList.add("popup_active");this.el.classList.add("active");this.removeExitTriggers()};plugin.prototype.removeExitTriggers=function(){var exit_triggers=document.getElementsByClassName("exit_trigger");for(var i=0;i<exit_triggers.length;i++)exit_triggers[i].parentNode.removeChild(exit_triggers[i])};
plugin.prototype.setExpireCookie=function(days){if(typeof days==="undefined"||days===-1)var days=365;var date=new Date;date.setTime(date.getTime()+days*24*60*60*1E3);var expires="; expires="+date.toGMTString();document.cookie="hide_offer_"+this.pid+"=1"+expires+";path=/"};plugin.prototype.readExpireCookie=function(){var nameEQ="hide_offer_"+this.pid+"";var ca=document.cookie.split("; ");for(var i=0;i<ca.length;i++)if(ca[i].indexOf(nameEQ)===0)return true;return false};plugin.prototype.eraseExpireCookie=
function(){this.setExpireCookie(-1)};plugin.prototype.setCSSLink=function(){return false;this.cssLink=document.createElement("link");if(typeof this.opts["css"]!="undefined")var href=this.opts["css"];else return false;this.cssLink.setAttribute("rel","stylesheet");this.cssLink.setAttribute("type","text/css");this.cssLink.setAttribute("href",href);this.cssLink.setAttribute("id","c_"+this.pid);document.getElementsByTagName("head")[0].appendChild(this.cssLink)};plugin.prototype.setOpts=function(){this.opts["css"]=
fillConst(this.consts.defaultCSSLink,{"class":this.type});var dataOpts=this.el.dataset;for(attr in dataOpts){var v=dataOpts[attr];switch(attr){case "offer":break;case "trigger":if(v.indexOf("exit")===0&&!this.opts.hasOwnProperty("prompt"))this.opts.prompt="Check out this special offer!";default:var optSplit=v.split(":");this.opts[attr]=attr==="expire"?parseInt(optSplit[0]):optSplit[0];if(optSplit.length>1)this.opts[attr+"Option"]=optSplit[1]}}if(!this.opts.hasOwnProperty("expire"))this.opts.expire=
0;this.setInlineOpts();return true};plugin.prototype.applyOpts=function(){var that=this;if(this.opts.style==="popup"){this.el.className="woobox-offer popup";var headCSS='.popup_active,.popup_active>body{height:100%;overflow:hidden}.woobox-offer.popup{-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";filter:alpha(opacity=0);-moz-opacity:0;-khtml-opacity:0;opacity:0;position:fixed;z-index:11111111!important;top:100%;right:0;bottom:0;left:0;transition:opacity .5s ease-out;overflow:hidden;visibility:visible;text-align:center;margin:auto;max-width:none!important;pointer-events:none}.woobox-offer.popup>.woobox-offer-wrap{position:absolute;z-index:2;right:0;left:0;width:88%;width:88vw;overflow:visible;margin:6% auto;margin:6vh auto}.woobox-offer.popup>.woobox-offer-wrap:before{display:block;content:"";position:fixed;z-index:-1;top:0;right:0;bottom:0;left:0}.woobox-offer.popup>.woobox-offer-wrap>iframe{position:relative;z-index:3;margin:0 auto;width:1px;min-width:100%}.woobox-offer.popup>.woobox-offer-wrap>.closer>.indicator{cursor:pointer;display:block;position:absolute;z-index:13;top:31px;right:-13px;width:20px;height:20px;color:#fff;color:rgba(255,255,255,.75);font-family:Verdana,sans-serif;font-size:14px;line-height:1.4;text-align:center;font-weight:400;border-width:2px;border-style:solid;border-color:#fff;border-color:rgba(255,255,255,.5);border-radius:20px}.woobox-offer.popup>.woobox-offer-wrap>.closer>.indicator:hover{border-color:rgba(255,255,255,.6);color:#fff}.woobox-offer.popup.active{-webkit-overflow-scrolling:touch;top:0;-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)";filter:alpha(opacity=100);-moz-opacity:1;-khtml-opacity:1;opacity:1;overflow:auto;pointer-events:auto}.woobox-offer.popup.active>.woobox-offer-wrap>.closer{display:block}.woobox-offer.popup .overlay{position:fixed;z-index:1;top:0;right:0;bottom:0;left:0;background:#000;background:rgba(0,0,0,.8)}.woobox-offer.popup .exit_trigger{pointer-events:auto;position:fixed;z-index:10001;background-color:transparent}.woobox-offer.popup .exit_trigger.top{top:0;right:0;left:0;height:12px;width:100%}.woobox-offer.popup .exit_trigger.bottom{bottom:0;right:0;left:0;height:12px;width:100%}.woobox-offer.popup .exit_trigger.right{top:0;right:0;bottom:0;width:12px;height:100%}.woobox-offer.popup .exit_trigger.left{top:0;bottom:0;left:0;width:12px;height:100%}.woobox-offer.popup .overlay,.woobox-offer.popup>.woobox-offer-wrap,.woobox-offer.popup>.woobox-offer-wrap>.closer{display:none}.woobox-offer.popup.active .overlay,.woobox-offer.popup.active>.woobox-offer-wrap,.woobox-offer.popup.active>.woobox-offer-wrap>.closer{display:block}'+
".woobox-offer-wrap{max-width: "+this.layout_width+"px;}"+".popup_active .woobox-offer-wrap{max-width: "+(this.layout_width+40)+"px;}"+"@media screen and (max-width: "+(this.layout_width+40)+"px) {.popup_active{position:fixed!important;left:0;right:0}.woobox-offer.popup>.woobox-offer-wrap{margin:0;max-width:100%;width:100%}.woobox-offer.popup>.woobox-offer-wrap>.closer>.indicator{top:24px;right:24px;background-color:rgba(0,0,0,.2)}.woobox-offer.popup>.woobox-offer-wrap>.closer>.indicator:hover{background-color:rgba(0,0,0,.8)}}";
if(this.opts.trigger==="exit"){var exit_trigger_size=12;var trigger_classes=["top","right","bottom","left"];for(i in trigger_classes){var exit_trigger=document.createElement("div");exit_trigger.className="exit_trigger "+trigger_classes[i];if(ev)exit_trigger.addEventListener("mouseover",function(){that.queueRevealBox(that)},false);else exit_trigger.attachEvent("onmouseover",function(){that.queueRevealBox(that)});this.el.appendChild(exit_trigger)}}var closer=document.createElement("div");closer.innerHTML=
'<span class="indicator">X</span>';closer.className="closer";if(ev)closer.addEventListener("click",this.closeBox,false);else closer.attachEvent("onclick",this.closeBox);this.el_wrap.appendChild(closer);var overlay=document.createElement("div");overlay.className="overlay";if(ev)overlay.addEventListener("click",this.closeBox,false);else overlay.attachEvent("onclick",this.closeBox);overlay.style["background"]=this.consts.classCSSMap["overlay"].background;overlay.style["opacity"]=parseInt(this.consts.classCSSMap["overlay"].opacity)/
100;this.el.appendChild(overlay);var headStyle=document.createElement("style");headStyle.type="text/css";if(headStyle.styleSheet)headStyle.styleSheet.cssText=headCSS;else headStyle.appendChild(document.createTextNode(headCSS));var head=document.head||document.getElementsByTagName("head")[0];head.appendChild(headStyle);var ms=this.opts.trigger==="timer"?parseInt(this.opts.triggerOption)*1E3:0;if(this.opts.trigger!=="exit")this.queueRevealBox(this,ms)}this.el.style.visibility="visible"};plugin.prototype.setFrames=
function(){for(var i=0;i<this.consts.classFrameMap[this.type].length;i++)for(var j in this.consts.frames)if(this.consts.classFrameMap[this.type][i]==j){this.frames[j]=new frame(this,j);this.frames[j].init()}};plugin.prototype.setInlineOpts=function(){var attrs=this.el.attributes;for(var i=0;i<attrs.length;i++)for(var j=0;j<this.consts.classOptionMap[this.type].length;j++)if(this.consts.classOptionMap[this.type][j]==attrs[i].name){var idx=this.consts.options[this.consts.classOptionMap[this.type][j]];
this.opts[idx]=attrs[i].value;break}};plugin.prototype.setLoading=function(){this.loading=true};plugin.prototype.clearLoading=function(){this.loading=false};var util={getOffsetTop:function(el){var offsetTop=0,tempEl=el;do if(!isNaN(tempEl.offsetTop))offsetTop+=tempEl.offsetTop;while(tempEl=tempEl.offsetParent);return offsetTop},getDocumentInfo:function(el){return{clientHeight:document.documentElement.clientHeight,clientWidth:document.documentElement.clientWidth,offsetTop:util.getOffsetTop(el),scrollLeft:document.body.scrollLeft,
scrollTop:document.body.scrollTop}},hasClass:function(el,cls){var classes=" "+el.className+" ";var logger=document.getElementById("logger");var index=classes.indexOf(" "+cls+" ");return index>-1}}}Woo=new Woobox;Woo.box()})()};
